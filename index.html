<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>pika shot</title>
    <meta name="theme-color" content="#4a90e2"/>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0/dist/mobilenet.min.js"></script>
</head>
<body>
    <!-- Loading Spinner (Fixes blank screen issue) -->
    <div id="loading-spinner" class="spinner-container">
        <div class="spinner"></div>
    </div>

    <!-- Onboarding Page -->
    <div id="page-onboarding" class="page">
        <!-- (Content is the same, no changes needed here) -->
        <div class="onboarding-content">
            <h1>Welcome to pika shot üì∏</h1>
            <p>The fastest way to track your sales.</p>
            <div class="form-group">
                <label for="user-name">Your Name</label>
                <input type="text" id="user-name" placeholder="e.g., Tunde">
            </div>
            <div class="form-group">
                <label for="business-name">Your Business Name</label>
                <input type="text" id="business-name" placeholder="e.g., Tunde's Store">
            </div>
            <button id="finish-onboarding-btn" class="btn-primary">Get Started</button>
        </div>
    </div>

    <!-- Main Dashboard Page -->
    <div id="page-dashboard" class="page">
        <header>
            <h1 id="dashboard-business-name">My Store</h1>
            <!-- NEW: Install App Button -->
            <button id="install-app-btn" class="header-btn hidden" aria-label="Install App">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            </button>
        </header>
        <main>
             <div class="sales-summary">
                <p>Today's Sales</p>
                <h2 id="total-sales">‚Ç¶0</h2>
            </div>
            <div id="sales-list"></div>
        </main>
        <footer>
            <button id="record-sale-btn" class="btn-primary">‚ö° Sell Item</button>
            <button id="manage-products-btn">üì¶ My Products</button>
        </footer>
    </div>

    <!-- Product Management Page -->
    <div id="page-products" class="page">
        <header>
            <button class="back-btn" data-target="page-dashboard">‚Üê</button>
            <h1>My Products</h1>
        </header>
        <main><div id="product-list"></div></main>
        <footer><button id="add-product-btn" class="btn-primary">‚ûï Add New Product</button></footer>
    </div>

    <!-- Camera Page -->
    <div id="page-camera" class="page">
        <video id="camera-view" autoplay playsinline></video>
        <div id="camera-overlay">
            <div id="camera-box" class="camera-box"></div>
            <p id="camera-instruction">Point camera at product</p>
            <div id="scan-feedback" class="hidden"></div>
        </div>
        <button id="cancel-camera-btn" class="btn-secondary">Cancel</button>
    </div>

    <!-- Modals -->
    <div id="modal-backdrop" class="modal-backdrop hidden">
        <!-- (All modals are now children of the backdrop for better control) -->
        
        <!-- NEW: Confirm Capture Modal -->
        <div id="modal-confirm-capture" class="modal hidden">
            <h3>Is this a good picture?</h3>
            <img id="capture-preview-img" src="" alt="Captured product image">
            <p class="modal-info">A clear picture helps the AI remember your product.</p>
            <div class="modal-actions">
                <button id="confirm-capture-btn" class="btn-primary">Looks Good</button>
                <button id="retry-capture-btn" class="btn-secondary">Try Again</button>
            </div>
        </div>
        
        <!-- Add New Product Modal -->
        <div id="modal-add-product" class="modal hidden">
            <h3>New Product Details</h3>
            <div class="form-group">
                <label for="product-name">Product Name</label>
                <input type="text" id="product-name" placeholder="e.g., Indomie Noodles">
            </div>
            <div class="form-group-row">
                <div class="form-group">
                    <label for="product-price">Price (‚Ç¶)</label>
                    <input type="number" id="product-price" placeholder="250">
                </div>
                <div class="form-group">
                    <label for="product-quantity">In Stock</label>
                    <input type="number" id="product-quantity" placeholder="50">
                </div>
            </div>
            <div class="form-group"> <!-- NEW: Unit Type -->
                <label for="product-unit">Unit Type (optional)</label>
                <input type="text" id="product-unit" placeholder="e.g., sachets, bottles, cans">
            </div>
            <div class="modal-actions">
                <button id="save-product-btn" class="btn-primary">Save Product</button>
                <button class="btn-secondary modal-cancel-btn">Cancel</button>
            </div>
        </div>

        <!-- NEW: Edit Product Modal -->
        <div id="modal-edit-product" class="modal hidden">
             <h3>Edit Product</h3>
            <div class="form-group">
                <label for="edit-product-name">Product Name</label>
                <input type="text" id="edit-product-name">
            </div>
            <div class="form-group-row">
                <div class="form-group">
                    <label for="edit-product-price">Price (‚Ç¶)</label>
                    <input type="number" id="edit-product-price">
                </div>
                <div class="form-group">
                    <label for="edit-product-quantity">In Stock</label>
                    <input type="number" id="edit-product-quantity">
                </div>
            </div>
             <div class="form-group">
                <label for="edit-product-unit">Unit Type</label>
                <input type="text" id="edit-product-unit">
            </div>
            <div class="modal-actions">
                <button id="save-edit-product-btn" class="btn-primary">Save Changes</button>
                <button class="btn-secondary modal-cancel-btn">Cancel</button>
            </div>
        </div>

        <!-- Sale Confirmation Modal -->
        <div id="modal-sale-confirm" class="modal hidden">
            <h3 id="sale-item-name">Product Name</h3>
            <img id="sale-item-image" src="" alt="Product Image">
            <p id="sale-item-price" class="sale-price-display"></p>
            <div class="form-group">
                <label for="sale-quantity">How many are you selling?</label>
                <input type="number" id="sale-quantity" value="1" min="1">
            </div>
            <p class="sale-total">Total: <span id="sale-total-price">‚Ç¶0</span></p>
            <div class="modal-actions">
                <button id="confirm-sale-btn" class="btn-primary">Confirm Sale</button>
                <button class="btn-secondary modal-cancel-btn">Cancel</button>
            </div>
        </div>
        
        <!-- Log Request Toast -->
        <div id="log-request-toast" class="toast hidden">
            <p>Incoming Purchase from Tolu!</p>
            <button id="view-log-request-btn">View Items</button>
        </div>
        <div id="modal-log-request" class="modal hidden"> <!-- (Unchanged) --></div>
    </div>
    
    <script src="db.js"></script>
    <script src="camera.js"></script>
    <script src="app.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4A90E2">
    <title>Pika Shot</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@latest"></script>
    <script defer src="db.js"></script>
    <script defer src="camera.js"></script>
    <script defer src="app.js"></script>
</head>
<body>
    <div id="loading-spinner" class="loading-overlay">
        <div class="spinner"></div>
        <p>Loading Pika Shot...</p>
    </div>

    <div id="app" style="display: none;">
        <main id="app-main">
            <div id="onboarding" class="view">
                <div class="onboard-content">
                    <div class="logo">ðŸ“¸</div>
                    <h1>Welcome to Pika Shot</h1>
                    <p>The fastest way to track your sales and stock.</p>
                    <div id="onboard-step1">
                        <input type="text" id="user-name" placeholder="Your Name">
                        <input type="text" id="business-name" placeholder="Your Business Name">
                        <button id="onboard-next" class="btn-primary">Next <i class="material-icons">arrow_forward</i></button>
                    </div>
                    <div id="camera-explain" style="display: none;">
                        <p>Pika Shot uses your camera to scan products instantly. Please grant access to continue.</p>
                        <button id="grant-camera" class="btn-primary">Grant Camera Access</button>
                    </div>
                </div>
            </div>

            <div id="home" class="view">
                <header class="app-header">
                    <h1 id="greeting">Hello!</h1>
                    <button id="install-btn" style="display: none;">Add to Home Screen</button>
                </header>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="card-icon money"><i class="material-icons">account_balance_wallet</i></div>
                        <div class="card-details">
                            <h2>Total Sales Today</h2>
                            <p id="total-sales">â‚¦0</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="card-icon items"><i class="material-icons">inventory_2</i></div>
                        <div class="card-details">
                            <h2>Items Sold Today</h2>
                            <p id="items-sold">0</p>
                        </div>
                    </div>
                </div>
                <div id="recent-sales">
                    <h3>Recent Sales</h3>
                    <ul id="sales-list">
                        </ul>
                </div>
            </div>

            <div id="products" class="view">
                <header class="app-header">
                    <h1>My Products</h1>
                </header>
                <div id="product-grid" class="grid">
                    </div>
                 <div id="empty-products" style="display: none; text-align: center; padding: 40px;">
                    <i class="material-icons" style="font-size: 60px; color: #ccc;">inbox</i>
                    <p>No products yet.</p>
                    <p>Tap "Add Product" to start scanning.</p>
                </div>
            </div>
            
            <div id="camera-view" class="view camera-fullscreen">
                <video id="video" autoplay playsinline></video>
                <div id="scan-overlay">
                     <div class="scan-line"></div>
                </div>
                <div class="camera-controls">
                    <p id="scan-message">Align product in the frame</p>
                    <button id="cancel-scan" class="btn-secondary"><i class="material-icons">close</i> Cancel</button>
                </div>
            </div>
            
            <div id="confirm-image" class="view">
                 <header class="app-header"><h1>Confirm Image</h1></header>
                 <div class="confirm-image-content">
                    <img id="confirm-img" src="" alt="Captured Image">
                    <p>Does this look right?</p>
                    <div class="button-group">
                        <button id="confirm-no" class="btn-secondary"><i class="material-icons">refresh</i> Try Again</button>
                        <button id="confirm-yes" class="btn-primary"><i class="material-icons">check</i> Yes, Looks Good</button>
                    </div>
                 </div>
            </div>

        </main>

        <nav id="bottom-nav" style="display: none;">
            <button class="nav-btn active" data-view="home"><i class="material-icons">home</i><span>Home</span></button>
            <button class="nav-btn" data-view="products"><i class="material-icons">inventory</i><span>Products</span></button>
            <button id="add-product-btn" class="nav-btn-special"><i class="material-icons">add_circle</i><span>Add Product</span></button>
            <button id="sell-item-btn" class="fab"><i class="material-icons">camera_alt</i><span>Sell</span></button>
        </nav>
        
        <div id="product-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <h2 id="product-modal-title">Add New Product</h2>
                <form id="add-form">
                    <img id="add-image" src="" alt="Product Image">
                    <input type="text" id="add-name" placeholder="Product Name" required>
                    <input type="number" id="add-price" placeholder="Price (â‚¦)" inputmode="decimal" required>
                    <input type="number" id="add-stock" placeholder="Stock Quantity" inputmode="numeric" required>
                    <input type="text" id="add-unit" placeholder="Unit (e.g., sachets, bottles)" required>
                    <input type="hidden" id="edit-id">
                    <div class="button-group">
                        <button type="button" id="cancel-add" class="btn-secondary">Cancel</button>
                        <button type="submit" id="save-product-btn" class="btn-primary">Save Product</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div id="sell-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <h2>Sell Product</h2>
                <img id="sell-image" src="" alt="Product">
                <h3 id="sell-name">Product Name</h3>
                <p class="sell-price-display">Price: â‚¦<span id="sell-price">0</span></p>
                <div class="quantity-control">
                    <label for="sell-quantity">Quantity:</label>
                    <input type="number" id="sell-quantity" min="1" value="1" inputmode="numeric" required>
                </div>
                <p class="sell-total-display">Total: â‚¦<span id="sell-total">0</span></p>
                <div class="button-group">
                    <button id="close-sell" type="button" class="btn-secondary">Cancel</button>
                    <button id="confirm-sale" class="btn-primary"><i class="material-icons">check</i> Confirm Sale</button>
                </div>
                <input type="hidden" id="sell-id">
            </div>
        </div>
        
        <div id="incoming-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <h2>Incoming Purchase</h2>
                <p>From: <strong>Tolu</strong></p>
                <ul class="incoming-list">
                    <li><span>10 x</span> Indomie Noodles</li>
                    <li><span>5 x</span> Peak Milk Sachets</li>
                </ul>
                <div class="button-group">
                    <button id="decline-incoming" class="btn-secondary">Decline</button>
                    <button id="accept-incoming" class="btn-primary">Accept</button>
                </div>
            </div>
        </div>
        
        <div id="toast-container">
            <div id="not-found-toast" class="toast" style="display: none;">
                <i class="material-icons">search_off</i><span>Product not found. Let's add it.</span>
            </div>
            <div id="incoming-toast" class="toast" style="display: none;">
                <span>Incoming Purchase from Tolu!</span> <button id="view-incoming">View</button>
            </div>
        </div>
    </div>
</body>
</html>
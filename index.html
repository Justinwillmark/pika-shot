<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pika Shot</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@latest"></script>
</head>
<body>
    <div id="loading-spinner" class="spinner">Loading...</div>

    <!-- Onboarding -->
    <div id="onboarding" class="view hidden">
        <h1>Welcome to Pika Shot</h1>
        <input type="text" id="user-name" placeholder="Your Name">
        <input type="text" id="business-name" placeholder="Business Name">
        <button id="onboard-next">Next</button>
        <div id="permission-explain" class="hidden">
            <p>We need camera access to scan products quickly. This helps you add and sell items easily without typing.</p>
            <button id="grant-permission">Grant Camera Access</button>
        </div>
    </div>

    <!-- Home -->
    <div id="home" class="view hidden">
        <header>
            <h1>Pika Shot</h1>
            <button id="install-btn" class="hidden">Add to Homescreen</button>
        </header>
        <section id="summary">
            <h2>Today's Summary</h2>
            <div class="stats">
                <div>Total Sales: <span id="total-sales">₦0</span></div>
                <div>Items Sold: <span id="items-sold">0</span></div>
                <div>Low Stock Items: <span id="low-stock">0</span></div>
            </div>
        </section>
        <section id="recent-sales">
            <h2>Recent Sales</h2>
            <ul id="recent-sales-list"></ul>
        </section>
        <nav>
            <button id="to-products"><svg>...</svg> My Products</button> <!-- Use actual SVG for inventory icon -->
            <button id="to-sell"><svg>...</svg> Sell Item</button> <!-- Use actual SVG for sell icon -->
        </nav>
    </div>

    <!-- My Products -->
    <div id="my-products" class="view hidden">
        <header>
            <button id="back-to-home-from-products">Back</button>
            <h1>My Products</h1>
        </header>
        <button id="add-product">Add New Product</button>
        <div id="products-grid" class="grid"></div>
    </div>

    <!-- Add Product -->
    <div id="add-product-view" class="view hidden">
        <header>
            <button id="cancel-add">Cancel</button>
            <h1>Add Product</h1>
        </header>
        <div id="camera-container">
            <video id="add-video" autoplay playsinline></video>
            <div id="add-countdown"></div>
            <button id="cancel-scan-add">Cancel</button>
        </div>
        <div id="confirm-capture" class="hidden">
            <img id="captured-img" src="">
            <button id="confirm-img">Confirm</button>
            <button id="try-again">Try Again</button>
        </div>
        <div id="product-form" class="hidden">
            <input type="text" id="product-name" placeholder="Product Name">
            <input type="number" id="product-price" placeholder="Price (₦)">
            <input type="number" id="product-stock" placeholder="Stock Quantity">
            <input type="text" id="product-unit" placeholder="Unit Type (e.g., sachets)">
            <button id="save-product">Save</button>
        </div>
    </div>

    <!-- Edit Product -->
    <div id="edit-product-view" class="view hidden">
        <header>
            <button id="back-to-products-from-edit">Back</button>
            <h1>Edit Product</h1>
        </header>
        <img id="edit-img" src="">
        <input type="text" id="edit-name" placeholder="Product Name">
        <input type="number" id="edit-price" placeholder="Price (₦)">
        <input type="number" id="edit-stock" placeholder="Stock Quantity">
        <input type="text" id="edit-unit" placeholder="Unit Type">
        <button id="update-product">Update</button>
    </div>

    <!-- Sell Item -->
    <div id="sell-view" class="view hidden">
        <header>
            <button id="cancel-sell">Cancel</button>
            <h1>Sell Item</h1>
        </header>
        <div id="sell-camera-container">
            <video id="sell-video" autoplay playsinline></video>
            <div id="sell-timer">Scanning...</div>
            <button id="cancel-scan-sell">Cancel</button>
        </div>
        <div id="sell-confirm" class="hidden">
            <img id="sell-img" src="">
            <p id="sell-name"></p>
            <p>Price: ₦<span id="sell-price"></span></p>
            <input type="number" id="sell-quantity" placeholder="Quantity" min="1">
            <p>Total: ₦<span id="sell-total">0</span></p>
            <button id="confirm-sale">Confirm Sale</button>
        </div>
        <div id="not-found" class="hidden">
            <p>Product not found. Add it now?</p>
            <img id="not-found-img" src="">
            <!-- Form same as add -->
            <input type="text" id="not-found-name" placeholder="Product Name">
            <input type="number" id="not-found-price" placeholder="Price (₦)">
            <input type="number" id="not-found-stock" placeholder="Stock Quantity">
            <input type="text" id="not-found-unit" placeholder="Unit Type">
            <button id="save-not-found">Save and Sell</button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="hidden">Incoming Purchase from Tolu! <button id="view-items">View Items</button></div>

    <!-- Communal Modal -->
    <div id="communal-modal" class="modal hidden">
        <h2>Incoming Items</h2>
        <ul>
            <li>Item 1: 10 units</li>
            <li>Item 2: 5 units</li>
        </ul>
        <button id="accept-communal">Accept</button>
        <button id="decline-communal">Decline</button>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

    <script src="db.js"></script>
    <script src="camera.js"></script>
    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/serviceworker.js');
        }
    </script>
</body>
</html>